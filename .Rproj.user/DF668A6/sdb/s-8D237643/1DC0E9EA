{
    "collab_server" : "",
    "contents" : "\n##TODO\n\n# Do I have the most recent version of the veg classes?\n\n###############\n## Clear the workspace\n###############\n\nrm(list=ls())\n\n###############\n## Global vars\n###############\n\nSUMMER = TRUE   # FALSE # \n\nWINTER = !SUMMER\n\nMODELSRUN <- TRUE\n\nspatialdir <- \"E:\\\\Dropbox\\\\Mule Deer\\\\Methods paper\\\\GIS\"\n\n##############\n# Load packages\n###############\n\nlibrary(lme4) #load lme4 package\nlibrary(Hmisc)\nlibrary(MuMIn)\nlibrary(ROCR)\nlibrary(rms)\nlibrary(RColorBrewer)\nlibrary(pROC)    # for running the delong test\n\nlibrary(raster)\nlibrary(rgdal)\n\n\n################\n# Load functions\n################\n\n#### Read in the RF functions from github\n\n# setwd(\"E:\\\\GIT\\\\Mule_Deer_RFvsRSF\")\n\nsource(\"RF_Extensions.R\")   # change to your script locations (not necessary if cloned from GITHUB)\n\nsource(\"METHODS_PAPER_ALLFUNCTIONS.R\")\n\n################\n## Read in Data\n################\n\nsummerdeer=read.csv('summer_main_modeldata_new25May2017.csv')  # read data file into R\n\nsummerdeer$altid=factor(summerdeer$altid) # convert catagorical variable to a vector of factor variables\nsummerdeer$veg_class=factor(summerdeer$veg_class)\n\nwinterdeer=read.csv('winter data 6_28_17.csv')  # read data file into R  winter_main_modeldata_new5May2017.csv\n\nwinterdeer$altid=factor(winterdeer$altid) # convert catagorical variable to a vector of factor variables\nwinterdeer$veg_class=factor(winterdeer$veg_class)\n\n##############\n# Standardize covariates\n##############\n\nsummerdeer$stand_dist_to_water=(summerdeer$dist_to_water-mean(summerdeer$dist_to_water))/sd(summerdeer$dist_to_water)\nsummerdeer$stand_cos_aspect=(summerdeer$cos_aspect-mean(summerdeer$cos_aspect))/sd(summerdeer$cos_aspect)\nsummerdeer$stand_sin_aspect=(summerdeer$sin_aspect-mean(summerdeer$sin_aspect))/sd(summerdeer$sin_aspect)\nsummerdeer$stand_elevation=(summerdeer$elevation-mean(summerdeer$elevation))/sd(summerdeer$elevation)\nsummerdeer$stand_slope=(summerdeer$slope-mean(summerdeer$slope))/sd(summerdeer$slope)\n\n\nwinterdeer$stand_dist_to_water=(winterdeer$dist_to_water-mean(winterdeer$dist_to_water))/sd(winterdeer$dist_to_water)\nwinterdeer$stand_cos_aspect=(winterdeer$cos_aspect-mean(winterdeer$cos_aspect))/sd(winterdeer$cos_aspect)\nwinterdeer$stand_sin_aspect=(winterdeer$sin_aspect-mean(winterdeer$sin_aspect))/sd(winterdeer$sin_aspect)\nwinterdeer$stand_elevation=(winterdeer$elevation-mean(winterdeer$elevation))/sd(winterdeer$elevation)\nwinterdeer$stand_slope=(winterdeer$slope-mean(winterdeer$slope))/sd(winterdeer$slope)\n\n\nsummerdeer$used_fac=factor(summerdeer$used)\n\nwinterdeer$used_fac=factor(winterdeer$used)\n\ndeer <- list()\n\ndeer[[\"summer\"]] <- summerdeer\ndeer[[\"winter\"]] <- winterdeer\n\nrm(summerdeer,winterdeer)\n\n###############\n# Naming covariables\n###############\n\n############### NAMING VARIABLES ############\n\npredictorNames <- c(  \"Cos Aspect\", # nice readable names\n                      \"Sin Aspect\",\n                      \"Elevation\",\n                      \"Slope\",\n                      \"Vegetation Class\",\n                      \"Distance to Water\"\n)\n\npred.names=c(  \"cos_aspect\",\n               \"sin_aspect\",\n               \"elevation\",\n               \"slope\",\n               \"veg_class\",\n               \"dist_to_water\"\n               \n)\n\n\n#name check\ncbind(pred.names,predictorNames)\n\nstand_pred.names <- paste(\"stand_\",pred.names,sep=\"\")\n\n\n##################\n## Run the generalized linear mixed model\n##################\n\nMODELSRUN <- TRUE\n# setwd(\"E:\\\\Dropbox\\\\Mule Deer\\\\Methods paper\\\\CODE_deprecated\")\n# MODELSRUN <- FALSE\nif(MODELSRUN){\n  load(\"summerGLMM.RData\")\n  load(\"winterGLMM.RData\")\n  \n  GLMMs <- list()\n  GLMMs[[\"winter\"]] <- winterGLMM\n  GLMMs[[\"summer\"]] <- summerGLMM\n  \n  rm(summerGLMM,winterGLMM)\n  \n}else{\n  summerGLMM=glmer(used~stand_dist_to_water + stand_cos_aspect + stand_sin_aspect + \n                              stand_elevation + stand_slope + veg_class + stand_elevation:stand_slope +\n                              stand_dist_to_water:stand_slope + stand_dist_to_water:stand_elevation +\n                              (1|altid), family=\"binomial\", data=deer[[\"summer\"]],na.action=\"na.fail\") # generalized linear mixed effect\n  \n  winterGLMM=glmer(used~stand_dist_to_water + stand_cos_aspect + stand_sin_aspect + \n                              stand_elevation + stand_slope + veg_class +  stand_elevation:stand_slope +\n                              stand_dist_to_water:stand_slope +\n                              (1|altid), family=\"binomial\", data=deer[[\"winter\"]],na.action=\"na.fail\") # generalized linear mixed effect \n                           \n    \n  GLMMs <- list()\n  GLMMs[[\"winter\"]] <- winterGLMM\n  GLMMs[[\"summer\"]] <- summerGLMM\n  \n  # summary(summer_pequop_final)\n  save(summerGLMM,file = \"summerGLMM.RData\")\n  save(winterGLMM,file = \"winterGLMM.RData\")\n  \n  rm(summerGLMM,winterGLMM)\n}\n\n\n\n##################\n## Run the Random Forest model\n##################\n\n#### Define response variable and formula\n\nresponse=\"used_fac\" \n\nformula1 <- as.formula(paste(response,\"~\",paste(pred.names,collapse=\"+\")))\n\n#### Define the RF settings\n\ncforestControl <- cforest_unbiased(ntree=500,mtry=3)   # change back to 500!!\ncforestControl@fraction <- 0.03\n\n#### Define our formula (response ~ predictors)\n\n#   MODELSRUN <- FALSE\nif(MODELSRUN){\n  load(\"summerRF.RData\")\n  load(\"winterRF.RData\")\n  \n  RFs <- list()\n  RFs[[\"winter\"]] <- winterRF\n  RFs[[\"summer\"]] <- summerRF\n  RFs[[\"winter_importance\"]] <- winter_importance\n  RFs[[\"summer_importance\"]] <- summer_importance\n  \n  rm(summerRF,summer_importance,winterRF,winter_importance)\n  \n}else{\n  \n  summerRF <- cforest(formula1, controls=cforestControl, data=deer[[\"summer\"]])\n  # get the importance values\n  summer_importance<-varimp((summerRF), conditional= FALSE)\n  \n  \n  winterRF <- cforest(formula1, controls=cforestControl, data=deer[[\"winter\"]])\n  # get the importance values\n  winter_importance<-varimp((winterRF), conditional= FALSE)\n  \n  RFs <- list()\n  RFs[[\"winter\"]] <- winterRF\n  RFs[[\"summer\"]] <- summerRF\n  RFs[[\"winter_importance\"]] <- winter_importance\n  RFs[[\"summer_importance\"]] <- summer_importance\n  \n  # summary(summer_pequop_final)\n  save(summerRF,summer_importance,file = \"summerRF.RData\")\n  save(winterRF,winter_importance,file = \"winterRF.RData\")\n  \n  rm(summerRF,summer_importance,winterRF,winter_importance)\n}\n\n\n#   MODELSRUN <- TRUE\n\n\n#######################\n# Visualize importance values\n#######################\n\ngraphics.off()\n\nsvg(\"importancefig.svg\",height=7,width=7)\n\npar(mfcol=c(2,2))\npar(mai=c(1,1.5,0.6,0.4))\nlengthndx <- length(RFs[[impname]])\ncol <- rainbow(lengthndx, start = 3/6, end = 4/6)      # rep(brewer.pal(6,\"Blues\"),each=2)\n\n\nseason <- \"summer\"\nimpname <- sprintf(\"%s_importance\",season)\n\nbarplot(height=RFs[[impname]][order(RFs[[impname]],decreasing = FALSE)],\n        horiz=T,las=1,main=\"Importance of Predictors, RF\",\n        xlab=\"Index of overall importance\",col=col,           \n        names.arg=predictorNames[match(names(RFs[[impname]]),pred.names)][order(RFs[[impname]],decreasing = FALSE)])\n\n\nseason <- \"winter\"\nimpname <- sprintf(\"%s_importance\",season)\n\n\n\nbarplot(height=RFs[[impname]][order(RFs[[impname]],decreasing = FALSE)],\n        horiz=T,las=1,main=\"Importance of Predictors, RF\",\n        xlab=\"Index of overall importance\",col=col,           \n        names.arg=predictorNames[match(names(RFs[[impname]]),pred.names)][order(RFs[[impname]],decreasing = FALSE)])\n\n\n##########\n# GLM \"importance\"? (coefficients of standardized variables?)\n##########\n\nseason=\"summer\"\nsumm <- summary(GLMMs[[season]])\n\nallvars <- names(summ$coefficients[,1])\n\n# remove interactions\nallvars <- allvars[-grep(\":\",allvars)]\n\n# keep the standardized vars\n\nallvars <- allvars[grep(\"stand\",allvars)]\n\nglm_importance <- summ$coefficients[,1][allvars]\n\n#glm_importance <- glm_importance[order(abs(glm_importance),decreasing = T)]\n\nbarplot(height=glm_importance[order(abs(glm_importance),decreasing = FALSE)],\n        horiz=T,las=1,main=\"Standardized coefficients, GLMM\",\n        xlab=\"Standardized coefficient\",col=col,           \n        names.arg=predictorNames[match(names(glm_importance),stand_pred.names)][order(abs(glm_importance),decreasing = FALSE)])\n\n\nseason=\"winter\"\nsumm <- summary(GLMMs[[season]])\n\nallvars <- names(summ$coefficients[,1])\n\n    # remove interactions\nallvars <- allvars[-grep(\":\",allvars)]\n\n    # keep the standardized vars\n\nallvars <- allvars[grep(\"stand\",allvars)]\n\nglm_importance <- summ$coefficients[,1][allvars]\n\n#glm_importance <- glm_importance[order(abs(glm_importance),decreasing = T)]\n\nbarplot(height=glm_importance[order(abs(glm_importance),decreasing = FALSE)],\n         horiz=T,las=1,main=\"Standardized coefficients, GLMM\",\n         xlab=\"Standardized coefficient\",col=col,           \n         names.arg=predictorNames[match(names(glm_importance),stand_pred.names)][order(abs(glm_importance),decreasing = FALSE)])\n\n\ndev.off()\n\n## note: comparison of RF vs GLMM \"importance\" values vs regression coefficients of standardized variables for RSF can \n    #  indicate the degree to which nonlinearities and interactions play a role!\n\n## note: RF gives an overall importance of categorical vars, GLMM cannot do that!\n\n\n\n\n#######################\n## Visualize univariate relationships\n#######################\n\npred.names\n\n## NOTE: we need to convert to real scale for the axes (unstandardized)\n\nseason <- \"summer\"\nVisualizeRelation(data=deer[[season]],model=GLMMs[[season]],predvar=\"cos_aspect\",type=\"GLMM\")\nVisualizeRelation(data=deer[[season]],model=GLMMs[[season]],predvar=\"sin_aspect\",type=\"GLMM\")\nVisualizeRelation(data=deer[[season]],model=GLMMs[[season]],predvar=\"elevation\",type=\"GLMM\")\nVisualizeRelation(data=deer[[season]],model=GLMMs[[season]],predvar=\"slope\",type=\"GLMM\")\nVisualizeRelation(data=deer[[season]],model=GLMMs[[season]],predvar=\"veg_class\",type=\"GLMM\")\nVisualizeRelation(data=deer[[season]],model=GLMMs[[season]],predvar=\"dist_to_water\",type=\"GLMM\")\n\nseason <- \"winter\"\nVisualizeRelation(data=deer[[season]],model=GLMMs[[season]],predvar=\"cos_aspect\",type=\"GLMM\")\nVisualizeRelation(data=deer[[season]],model=GLMMs[[season]],predvar=\"sin_aspect\",type=\"GLMM\")\nVisualizeRelation(data=deer[[season]],model=GLMMs[[season]],predvar=\"elevation\",type=\"GLMM\")\nVisualizeRelation(data=deer[[season]],model=GLMMs[[season]],predvar=\"slope\",type=\"GLMM\")\nVisualizeRelation(data=deer[[season]],model=GLMMs[[season]],predvar=\"veg_class\",type=\"GLMM\")\nVisualizeRelation(data=deer[[season]],model=GLMMs[[season]],predvar=\"dist_to_water\",type=\"GLMM\")\n\n\nseason=\"summer\"\ngraphics.off()\n\nsvg(\"summerunivarplots.svg\",6,6)\npar(mfcol=c(3,2))\npar(mai=c(0.8,0.8,0,0))\n\n\nVisualizeRelation(data=deer[[season]],model=RFs[[season]],predvar=\"elevation\",type=\"RF\")\nVisualizeRelation(data=deer[[season]],model=RFs[[season]],predvar=\"slope\",type=\"RF\")\nVisualizeRelation(data=deer[[season]],model=RFs[[season]],predvar=\"dist_to_water\",type=\"RF\")\n\n\nVisualizeRelation(data=deer[[season]],model=GLMMs[[season]],predvar=\"elevation\",type=\"GLMM\")\nVisualizeRelation(data=deer[[season]],model=GLMMs[[season]],predvar=\"slope\",type=\"GLMM\")\nVisualizeRelation(data=deer[[season]],model=GLMMs[[season]],predvar=\"dist_to_water\",type=\"GLMM\")\n\ndev.off()\n\ngraphics.off()\nseason <- \"winter\"\nsvg(\"winterunivariateplots.svg\",6,6)\n\npar(mfcol=c(3,2))\npar(mai=c(0.8,0.8,0,0))\n\n\nVisualizeRelation(data=deer[[season]],model=RFs[[season]],predvar=\"elevation\",type=\"RF\")\nVisualizeRelation(data=deer[[season]],model=RFs[[season]],predvar=\"slope\",type=\"RF\")\nVisualizeRelation(data=deer[[season]],model=RFs[[season]],predvar=\"dist_to_water\",type=\"RF\")\n\n\nVisualizeRelation(data=deer[[season]],model=GLMMs[[season]],predvar=\"elevation\",type=\"GLMM\")\nVisualizeRelation(data=deer[[season]],model=GLMMs[[season]],predvar=\"slope\",type=\"GLMM\")\nVisualizeRelation(data=deer[[season]],model=GLMMs[[season]],predvar=\"dist_to_water\",type=\"GLMM\")\n\ndev.off()\n\n\ngraphics.off()\nseason=\"summer\"\nsvg(\"vegplots.svg\",6,6)\n\npar(mfrow=c(2,2))\npar(mai=c(1.5,0.8,0,0))\n\nVisualizeRelation(data=deer[[season]],model=RFs[[season]],predvar=\"veg_class\",type=\"RF\")\nVisualizeRelation(data=deer[[season]],model=GLMMs[[season]],predvar=\"veg_class\",type=\"GLMM\")\n\n\n\nseason=\"winter\"\n#svg(\"wintervegplots.svg\",6,5)\n\nVisualizeRelation(data=deer[[season]],model=RFs[[season]],predvar=\"veg_class\",type=\"RF\")\nVisualizeRelation(data=deer[[season]],model=GLMMs[[season]],predvar=\"veg_class\",type=\"GLMM\")\n\ndev.off()\n\n#######################\n## Visualize interactions\n########################\n\n\ngraphics.off()\n\nseason <- \"summer\"\n\n\nVisualizeInteraction(data=deer[[season]],model=GLMMs[[season]],var1=\"dist_to_water\",var2=\"elevation\")\n\n#VisualizeInteraction(data=deer[[season]],model=GLMMs[[season]],var1=\"stand_elevation\",var2=\"stand_dist_to_water\")\n\n#VisualizeInteraction(data=deer[[season]],model=GLMMs[[season]],var1=\"stand_slope\",var2=\"stand_dist_to_water\")\n\nVisualizeInteraction(data=deer[[season]],model=GLMMs[[season]],var2=\"slope\",var1=\"dist_to_water\")\n\nVisualizeInteraction(data=deer[[season]],model=GLMMs[[season]],var1=\"slope\",var2=\"elevation\")\n\n\n\nseason <- \"winter\"\n\nVisualizeInteraction(data=deer[[season]],model=GLMMs[[season]],var1=\"dist_to_water\",var2=\"elevation\")\n\n#VisualizeInteraction(data=deer[[season]],model=GLMMs[[season]],var1=\"stand_elevation\",var2=\"stand_dist_to_water\")\n\n#VisualizeInteraction(data=deer[[season]],model=GLMMs[[season]],var1=\"stand_slope\",var2=\"stand_dist_to_water\")\n\nVisualizeInteraction(data=deer[[season]],model=GLMMs[[season]],var2=\"slope\",var1=\"dist_to_water\")\n\nVisualizeInteraction(data=deer[[season]],model=GLMMs[[season]],var1=\"slope\",var2=\"elevation\")\n\n#VisualizeInteraction(data=deer[[season]],model=GLMMs[[season]],var1=\"stand_slope\",var2=\"stand_elevation\")\n\n\ngraphics.off()\nsvg(\"disttowater_vs_elevation.svg\",6,6)\npar(mfrow=c(2,2))\n\nseason <- \"summer\"\nVisualizeInteraction(data=deer[[season]],model=RFs[[season]],var1=\"dist_to_water\",var2=\"elevation\",type=\"RF\")\nVisualizeInteraction(data=deer[[season]],model=GLMMs[[season]],var1=\"dist_to_water\",var2=\"elevation\",type=\"GLMM\")\n\n\nseason <- \"winter\"\nVisualizeInteraction(data=deer[[season]],model=RFs[[season]],var1=\"dist_to_water\",var2=\"elevation\",type=\"RF\")\nVisualizeInteraction(data=deer[[season]],model=GLMMs[[season]],var1=\"dist_to_water\",var2=\"elevation\",type=\"GLMM\")\n\ndev.off()\n\n\ngraphics.off()\nsvg(\"slope_vs_elevation.svg\",6,6)\npar(mfrow=c(2,2))\n\nseason <- \"summer\"\nVisualizeInteraction(data=deer[[season]],model=RFs[[season]],var1=\"slope\",var2=\"elevation\",type=\"RF\")\nVisualizeInteraction(data=deer[[season]],model=GLMMs[[season]],var1=\"slope\",var2=\"elevation\",type=\"GLMM\")\n\n\nseason <- \"winter\"\nVisualizeInteraction(data=deer[[season]],model=RFs[[season]],var1=\"slope\",var2=\"elevation\",type=\"RF\")\nVisualizeInteraction(data=deer[[season]],model=GLMMs[[season]],var1=\"slope\",var2=\"elevation\",type=\"GLMM\")\n\ndev.off()\n\n\n\n#################\n# MODEL SELECTION: GLMM\n#################\n\n\nif(!MODELSRUN){\n  \n  #### Summer Global model\n  \n  summer_pequop_model=glmer(used~stand_dist_to_water +\n                              stand_cos_aspect + \n                              stand_sin_aspect +\n                              stand_elevation +\n                              stand_slope +\n                              veg_class +\n                              stand_dist_to_water:stand_elevation + \n                              stand_dist_to_water:stand_slope +\n                              stand_elevation:stand_slope + \n                              (1|altid),\n              family=\"binomial\",data=deer$summer,nAGQ = 1, na.action=\"na.fail\") # generalized linear mixed effect \n  \n  \n  summer_dred <- dredge(summer_pequop_model, trace = TRUE, rank = \"AICc\", REML = FALSE)\n  summer_dred\n  \n  model_summary_summer <- summary(summer_pequop_model)\n  \n  write.csv(model_summary_summer$coefficients, file= \"top_summer_main_result19April2017.csv\")\n  write.csv(summer_dred, file= \"summer_main_dredge_result_10April2017.csv\")\n  \n  \n  #### Winter Global model\n  \n  winter_pequop_model=glmer(used~stand_dist_to_water +\n                              stand_cos_aspect + \n                              stand_sin_aspect +\n                              stand_elevation +\n                              stand_slope +\n                              veg_class +\n                              stand_dist_to_water:stand_elevation + \n                              stand_dist_to_water:stand_slope +\n                              stand_elevation:stand_slope + \n                              (1|altid),\n                            family=\"binomial\",data=deer$winter,nAGQ = 1, na.action=\"na.fail\") # generalized linear mixed effect \n  \n  model_summary_winter <- summary(winter_pequop_model)\n  \n  winter_dred<- dredge(winter_pequop_model, trace = TRUE, rank = \"AICc\", REML = FALSE)\n  winter_dred\n  \n  write.csv(model_summary_winter$coefficients, file= \"top_winter_main_result19April2017.csv\")\n  write.csv(winter_dred, file= \"winter_main_dredge_result_10April2017.csv\")\n  \n\n}\n\n\n######################\n# RF Interactions\n######################\n\nRF_int <- list()\n\nseason <- \"summer\"\n\n# NOTE: this one can take a very long time   ...\nRF_int[[season]] <- RF_FindInteractions(object=RFs[[season]],data=deer[[season]],predictors=pred.names)\n\n### plot interaction strength\ngraphics.off()\nlengthndx <- min(9,nrow(RF_int[[season]]$rank.list1))\npar(mai=c(0.95,3.1,0.6,0.4))\n#ndx <- ndx <- which(predictors%in%pred.names)\nbarplot(height=(RF_int[[season]]$rank.list1[c(1:min(9,nrow(RF_int[[season]]$rank.list1))),5][c(lengthndx:1)]),\n        horiz=T,las=1,main=paste(response, sep=\"\"),\n        xlab=\"Index of interaction strength\",col=brewer.pal(lengthndx,\"Blues\"),           \n        names.arg=paste(\"\",predictorNames[match(RF_int[[season]]$rank.list1[,2][c(lengthndx:1)],pred.names)],\"\\n\",predictorNames[match(RF_int[[season]]$rank.list1[,4][c(lengthndx:1)],pred.names)],sep=\"\") )\n\nRF_int[[season]]$rank.list1\n\nseason <- \"winter\"\n\n# NOTE: this one can take a very long time   ...\nRF_int[[season]] <- RF_FindInteractions(object=RFs[[season]],data=deer[[season]],predictors=pred.names)\n\n### plot interaction strength\ngraphics.off()\nlengthndx <- min(9,nrow(RF_int[[season]]$rank.list1))\npar(mai=c(0.95,3.1,0.6,0.4))\n#ndx <- ndx <- which(predictors%in%pred.names)\nbarplot(height=(RF_int[[season]]$rank.list1[c(1:min(9,nrow(RF_int[[season]]$rank.list1))),5][c(lengthndx:1)]),\n        horiz=T,las=1,main=paste(response, sep=\"\"),\n        xlab=\"Index of interaction strength\",col=brewer.pal(lengthndx,\"Blues\"),           \n        names.arg=paste(\"\",predictorNames[match(RF_int[[season]]$rank.list1[,2][c(lengthndx:1)],pred.names)],\"\\n\",predictorNames[match(RF_int[[season]]$rank.list1[,4][c(lengthndx:1)],pred.names)],sep=\"\") )\n\nRF_int[[season]]$rank.list1\n\n\n\n##### PLOT EXAMPLE CONDITIONAL INFERENCE TREE  ##################\n\nseason=\"winter\"\n\nsummer_deer <- ctree(formula=formula1, data=df, controls = ctree_control(mincriterion = 0.99,maxdepth = 4))\n\nplot(summer_deer)\n\nsummary(summer_deer)\n\n\n\n##################\n## CROSS VALIDATION\n##################\n\nCVsRun <- TRUE\n\nif(CVsRun){\n  \n  # setwd(\"E:\\\\Dropbox\\\\Mule Deer\\\\Methods paper\\\\CODE_deprecated\")\n  load(\"CVs.RData\")\n  \n}else{\n  CVs <- list()\n  \n  CVs[[\"GLMM\"]] <- list()\n  CVs[[\"RF\"]] <- list()\n  \n  uniquedeer <- as.character(unique(deer[[season]]$altid))\n  n.folds <- length(uniquedeer)\n  \n  \n  type= \"GLMM\" #\"RF\"\n  season=\"summer\"\n  CVs[[type]][[season]] <- CrossValidateByDeer(n.fold=n.folds,season=season,type=type,plot=F)\n  \n  type= \"GLMM\" #\"RF\"\n  season=\"winter\"\n  CVs[[type]][[season]] <- CrossValidateByDeer(n.fold=n.folds,season=season,type=type,plot=F)\n  \n  type= \"RF\" #\"RF\"\n  season=\"summer\"\n  CVs[[type]][[season]] <- CrossValidateByDeer(n.fold=n.folds,season=season,type=type,plot=F)\n  \n  type= \"RF\" #\"RF\"\n  season=\"winter\"\n  CVs[[type]][[season]] <- CrossValidateByDeer(n.fold=n.folds,season=season,type=type,plot=F)\n  \n  ## Save CV objects\n  # setwd(\"E:\\\\Dropbox\\\\Mule Deer\\\\Methods paper\\\\CODE_deprecated\")\n  \n  save(CVs,file = \"CVs.RData\")\n  \n}\n\ntype= \"GLMM\" #\"RF\"\nseason=\"summer\"\nPlotPerformance(CVs[[type]][[season]])\n\ntype= \"GLMM\" #\"RF\"\nseason=\"winter\"\nPlotPerformance(CVs[[type]][[season]])\n\ntype= \"RF\" #\"RF\"\nseason=\"summer\"\nPlotPerformance(CVs[[type]][[season]])\n\ntype= \"RF\" #\"RF\"\nseason=\"winter\"\nPlotPerformance(CVs[[type]][[season]])\n\n######################\n# run the Delong test\n######################\n\n?roc.test\n\n### summer\nseason=\"summer\"\nroc1 <- roc(CVs$GLMM[[season]]$observed,CVs$GLMM[[season]]$CVpred)\nroc2 <- roc(CVs$RF[[season]]$observed,CVs$RF[[season]]$CVpred)\nroc.test(roc1, roc2)\n\n### winter\nseason=\"winter\"\nroc1 <- roc(CVs$GLMM[[season]]$observed,CVs$GLMM[[season]]$CVpred)\nroc2 <- roc(CVs$RF[[season]]$observed,CVs$RF[[season]]$CVpred)\nroc.test(roc1, roc2)\n\n\n# print RMSE statistics\nCV_RMSE \nwrite.csv(CV_RMSE,file=\"CV_RMSE_10percent.csv\")\nreal_RMSE\nwrite.csv(real_RMSE,file=\"real_RMSE_10percent.csv\")\n\n\n\n\n###################\n## DO SPATIAL PROJECTIONS\n###################\n\nsetwd(spatialdir)\n\nrastercovs <- list()\n\nrastercovs[[\"winter\"]] <- list()\nrastercovs[[\"summer\"]] <- list()\n\n##########\n# READ IN GIS DATA\n##########\n\n## summer cosine\nsetwd(\"E:\\\\Dropbox\\\\Mule Deer\\\\Methods paper\\\\GIS\\\\Rasters\\\\summer_cos\")\nrastercovs[[\"summer\"]][[\"cos_aspect\"]] <- raster(\"w001001.adf\") \n   #rastercovs[[\"summer\"]][[\"cos_aspect\"]] <- trim(rastercovs[[\"summer\"]][[\"cos_aspect\"]]) # note: trim function takes too long to run here..\nplot(rastercovs[[\"summer\"]][[\"cos_aspect\"]])\n\nold_summer_extent <- extent(rastercovs[[\"summer\"]][[\"cos_aspect\"]])\nsummer_extent <- extent(old_summer_extent@xmin,680000,4580000,4635000)\nrastercovs[[\"summer\"]][[\"cos_aspect\"]] <- crop(rastercovs[[\"summer\"]][[\"cos_aspect\"]],summer_extent)\nplot(rastercovs[[\"summer\"]][[\"cos_aspect\"]])\n\nrastercovs[[\"summer\"]][[\"cos_aspect\"]] <- trim(rastercovs[[\"summer\"]][[\"cos_aspect\"]])\nsummer_extent <- extent(rastercovs[[\"summer\"]][[\"cos_aspect\"]])   # final extent!\nrastercovs[[\"summer\"]][[\"cos_aspect\"]] <- crop(rastercovs[[\"summer\"]][[\"cos_aspect\"]],summer_extent)\nplot(rastercovs[[\"summer\"]][[\"cos_aspect\"]])\n\nrastercovs[[\"summer\"]][[\"cos_aspect\"]] <- aggregate(rastercovs[[\"summer\"]][[\"cos_aspect\"]], fact=3, fun=modal)\nplot(rastercovs[[\"summer\"]][[\"cos_aspect\"]])\n\nsummer_crs <- rastercovs[[\"summer\"]][[\"cos_aspect\"]]@crs \n\n## summer sine\nsetwd(\"E:\\\\Dropbox\\\\Mule Deer\\\\Methods paper\\\\GIS\\\\Rasters\\\\summer_sin\")\nrastercovs[[\"summer\"]][[\"sin_aspect\"]] <- raster(\"w001001.adf\")\nrastercovs[[\"summer\"]][[\"sin_aspect\"]] <- crop(rastercovs[[\"summer\"]][[\"sin_aspect\"]],summer_extent)\nrastercovs[[\"summer\"]][[\"sin_aspect\"]] <- aggregate(rastercovs[[\"summer\"]][[\"sin_aspect\"]], fact=3, fun=modal)\nplot(rastercovs[[\"summer\"]][[\"sin_aspect\"]])\n\n## summer elevation\nsetwd(\"E:\\\\Dropbox\\\\Mule Deer\\\\Methods paper\\\\GIS\\\\Rasters\\\\summer_elev\")\nrastercovs[[\"summer\"]][[\"elevation\"]] <- raster(\"w001001.adf\")\nrastercovs[[\"summer\"]][[\"elevation\"]] <- crop(rastercovs[[\"summer\"]][[\"elevation\"]],summer_extent)\nrastercovs[[\"summer\"]][[\"elevation\"]] <- aggregate(rastercovs[[\"summer\"]][[\"elevation\"]], fact=3, fun=modal)\nplot(rastercovs[[\"summer\"]][[\"elevation\"]])\n\n## summer slope\nsetwd(\"E:\\\\Dropbox\\\\Mule Deer\\\\Methods paper\\\\GIS\\\\Rasters\\\\summer_slope\")\nrastercovs[[\"summer\"]][[\"slope\"]] <- raster(\"w001001.adf\")\nrastercovs[[\"summer\"]][[\"slope\"]] <- crop(rastercovs[[\"summer\"]][[\"slope\"]],summer_extent)\nrastercovs[[\"summer\"]][[\"slope\"]] <- aggregate(rastercovs[[\"summer\"]][[\"slope\"]], fact=3, fun=modal)\nplot(rastercovs[[\"summer\"]][[\"slope\"]])\n\n## summer dist to water\nsetwd(spatialdir)\nrastercovs[[\"summer\"]][[\"dist_to_water\"]] <- raster(\"Summer_H20.tif\")\nrastercovs[[\"summer\"]][[\"dist_to_water\"]] <- crop(rastercovs[[\"summer\"]][[\"dist_to_water\"]],summer_extent)\nrastercovs[[\"summer\"]][[\"dist_to_water\"]] <- aggregate(rastercovs[[\"summer\"]][[\"dist_to_water\"]], fact=3, fun=modal)\n#extent(rastercovs[[\"summer\"]][[\"dist_to_water\"]]) <- summer_extent \nrastercovs[[\"summer\"]][[\"dist_to_water\"]] <- projectRaster(rastercovs[[\"summer\"]][[\"dist_to_water\"]],rastercovs[[\"summer\"]][[\"slope\"]])\nplot(rastercovs[[\"summer\"]][[\"dist_to_water\"]])\n\n## summer veg\nsetwd(\"E:\\\\Dropbox\\\\Mule Deer\\\\Methods paper\\\\GIS\\\\Summer_veg_raster\\\\Summer_veg_raster\")\nrastercovs[[\"summer\"]][[\"veg_class\"]] <- raster(\"summer_veg.tif\")\nrastercovs[[\"summer\"]][[\"veg_class\"]] <- crop(rastercovs[[\"summer\"]][[\"veg_class\"]],summer_extent)\nattrib <- rastercovs[[\"summer\"]][[\"veg_class\"]]@data@attributes\ntarget <- levels(deer$summer$veg_class)\nsubs <- attrib[[1]][,c(\"Value\",\"Habitat_Type\")]\nsubs$HabType2 <- c(\"Riparian\",\"PJ\",\"mtn_mahog\",\"asage\",\"intro_grass\",\"grassland\",\"shb_mead\",\"roads\",\"desert_scrub\",\"Dec_shrub\",\"aspen\",\"NA\")\nhabitats <- rastercovs[[\"summer\"]][[\"veg_class\"]]@data@attributes[[1]]$Habitat_Type\nis.factor(rastercovs[[\"summer\"]][[\"veg_class\"]])\nrastercovs[[\"summer\"]][[\"veg_class\"]] <- aggregate(rastercovs[[\"summer\"]][[\"veg_class\"]], fact=3, fun=modal)\nrastercovs[[\"summer\"]][[\"veg_class\"]] <- projectRaster(rastercovs[[\"summer\"]][[\"veg_class\"]],rastercovs[[\"summer\"]][[\"slope\"]],method=\"ngb\")\nrastercovs[[\"summer\"]][[\"veg_class\"]] <- ratify(rastercovs[[\"summer\"]][[\"veg_class\"]])\nrat <- levels(rastercovs[[\"summer\"]][[\"veg_class\"]])[[1]]\nrat$landcover <- subs$HabType2\nrat$code <- subs$Habitat_Type\nlevels(rastercovs[[\"summer\"]][[\"veg_class\"]]) <- rat\n\n#rastercovs[[\"summer\"]][[\"veg_class\"]]@data@attributes <- attrib\nunique(rastercovs$summer$veg_class@data@values)\n\n# rastercovs[[\"summer\"]][[\"veg_class\"]] <- reclassify(rastercovs[[\"summer\"]][[\"veg_class\"]],rcl=c(46,48,NA)) \n# rastercovs[[\"summer\"]][[\"veg_class\"]] <- subs(rastercovs[[\"summer\"]][[\"veg_class\"]],subs[,c(\"Value\",\"HabType2\")],by=1,which=2)\n# rastercovs[[\"summer\"]][[\"veg_class\"]] <- as.factor(rastercovs[[\"summer\"]][[\"veg_class\"]])\nplot(rastercovs[[\"summer\"]][[\"veg_class\"]])\n\nres(rastercovs[[\"summer\"]][[\"veg_class\"]])\n\n#########\n# WINTER!\n#########\n\n## winter cosine    ## DOESN'T WORK\nsetwd(\"E:\\\\Dropbox\\\\Mule Deer\\\\Methods paper\\\\GIS\\\\Rasters\\\\winter_cos\")\nrastercovs[[\"winter\"]][[\"cos_aspect\"]] <- raster(\"w001001.adf\") \n#rastercovs[[\"winter\"]][[\"cos_aspect\"]] <- trim(rastercovs[[\"winter\"]][[\"cos_aspect\"]]) # note: trim function takes too long to run here..\nplot(rastercovs[[\"winter\"]][[\"cos_aspect\"]])\n\n# dpath<-\"E:\\\\Dropbox\\\\Mule Deer\\\\Methods paper\\\\GIS\\\\Rasters\\\\winter_cos\\\\w001001.adf\" \n# x <- new(\"GDALReadOnlyDataset\", dpath) \n# getDriver(x) \n# getDriverLongName(getDriver(x)) \n\nrastercovs[[\"winter\"]][[\"cos_aspect\"]] <- trim(rastercovs[[\"winter\"]][[\"cos_aspect\"]])\nwinter_extent <- extent(rastercovs[[\"winter\"]][[\"cos_aspect\"]])   # final extent!\nrastercovs[[\"winter\"]][[\"cos_aspect\"]] <- crop(rastercovs[[\"winter\"]][[\"cos_aspect\"]],winter_extent)\nplot(rastercovs[[\"winter\"]][[\"cos_aspect\"]])\n\nrastercovs[[\"winter\"]][[\"cos_aspect\"]] <- aggregate(rastercovs[[\"winter\"]][[\"cos_aspect\"]], fact=3, fun=modal)\nplot(rastercovs[[\"winter\"]][[\"cos_aspect\"]])\n\n## winter sine  ## DOESN'T WORK\nsetwd(\"E:\\\\Dropbox\\\\Mule Deer\\\\Methods paper\\\\GIS\\\\Rasters\\\\winter_sin\")\nrastercovs[[\"winter\"]][[\"sin_aspect\"]] <- raster(\"w001001.adf\")\nrastercovs[[\"winter\"]][[\"sin_aspect\"]] <- crop(rastercovs[[\"winter\"]][[\"sin_aspect\"]],winter_extent)\nrastercovs[[\"winter\"]][[\"sin_aspect\"]] <- aggregate(rastercovs[[\"winter\"]][[\"sin_aspect\"]], fact=3, fun=modal)\nplot(rastercovs[[\"winter\"]][[\"sin_aspect\"]])\n\n## winter elevation\nsetwd(\"E:\\\\Dropbox\\\\Mule Deer\\\\Methods paper\\\\GIS\\\\Rasters\\\\winter_elev\")\nrastercovs[[\"winter\"]][[\"elevation\"]] <- raster(\"w001001.adf\")\nrastercovs[[\"winter\"]][[\"elevation\"]] <- crop(rastercovs[[\"winter\"]][[\"elevation\"]],winter_extent)\nrastercovs[[\"winter\"]][[\"elevation\"]] <- aggregate(rastercovs[[\"winter\"]][[\"elevation\"]], fact=3, fun=modal)\nplot(rastercovs[[\"winter\"]][[\"elevation\"]])\n\n## winter slope  ## DOESN'T WORK\nsetwd(\"E:\\\\Dropbox\\\\Mule Deer\\\\Methods paper\\\\GIS\\\\Rasters\\\\winter_slope\")\nrastercovs[[\"winter\"]][[\"slope\"]] <- raster(\"w001001.adf\")\nrastercovs[[\"winter\"]][[\"slope\"]] <- crop(rastercovs[[\"winter\"]][[\"slope\"]],winter_extent)\nrastercovs[[\"winter\"]][[\"slope\"]] <- aggregate(rastercovs[[\"winter\"]][[\"slope\"]], fact=3, fun=modal)\nplot(rastercovs[[\"winter\"]][[\"slope\"]])\n\n## winter dist to water\nsetwd(spatialdir)\nrastercovs[[\"winter\"]][[\"dist_to_water\"]] <- raster(\"Winter_H2O.tif\")\nrastercovs[[\"winter\"]][[\"dist_to_water\"]] <- crop(rastercovs[[\"winter\"]][[\"dist_to_water\"]],winter_extent)\nrastercovs[[\"winter\"]][[\"dist_to_water\"]] <- aggregate(rastercovs[[\"winter\"]][[\"dist_to_water\"]], fact=3, fun=modal)\nplot(rastercovs[[\"winter\"]][[\"dist_to_water\"]])\n\n## winter veg\nsetwd(\"E:\\\\Dropbox\\\\Mule Deer\\\\Methods paper\\\\GIS\\\\Winter_veg_raster\\\\Winter_veg_raster\")\nrastercovs[[\"winter\"]][[\"veg_class\"]] <- raster(\"winter_veg.tif\")\nrastercovs[[\"winter\"]][[\"veg_class\"]] <- crop(rastercovs[[\"winter\"]][[\"veg_class\"]],winter_extent)\nrastercovs[[\"winter\"]][[\"veg_class\"]] <- aggregate(rastercovs[[\"winter\"]][[\"veg_class\"]], fact=3, fun=modal,method=\"ngb\")\nplot(rastercovs[[\"winter\"]][[\"veg_class\"]])\n\nres(rastercovs[[\"winter\"]][[\"veg_class\"]])\n\n\n###############\n# Further GIS data processing\n###############\n\nrastercovs$summer <- stack(rastercovs$summer)   # done\n\nplot(rastercovs$summer)\n\n\n###############\n# Make prediction for summer habitat using GLMM \n###############\n\n#GLMMs[[\"summer\"]]\n\nrastercovs$summer$stand_cos_aspect <- (rastercovs$summer$cos_aspect- mean(deer$summer$cos_aspect))/sd(deer$summer$cos_aspect)\nplot(rastercovs$summer$stand_cos_aspect)\n\nrastercovs$summer$stand_sin_aspect <- (rastercovs$summer$sin_aspect- mean(deer$summer$sin_aspect))/sd(deer$summer$sin_aspect)\n\nrastercovs$summer$stand_elevation <- (rastercovs$summer$elevation- mean(deer$summer$elevation))/sd(deer$summer$elevation)\n\nrastercovs$summer$stand_slope <- (rastercovs$summer$slope- mean(deer$summer$slope))/sd(deer$summer$slope)\n\nrastercovs$summer$stand_dist_to_water <- (rastercovs$summer$dist_to_water- mean(deer$summer$dist_to_water))/sd(deer$summer$dist_to_water)\n\nis.factor(rastercovs$summer$veg_class)\nrat$classes <- rat$landcover\nlevels(rastercovs$summer$veg_class) <- rat[,c(\"ID\",\"classes\")]\n\npredmaps <- list()\npredmaps[[\"summer\"]] <- list()\n\ncat_cov <- c(\"veg_class\")\nveg_class <- levels(rastercovs$summer$veg_class)\nnames(veg_class) <- \"veg_class\"\n\nfactor_list <- list(veg_class)\nnames(factor_list) <- cat_cov\n\naltid<-factor( 'P003',levels=levels(deer[[\"summer\"]]$altid))\nadd2<-data.frame(altid)\nstr(add2)\n\npredmaps[[\"summer\"]][[\"GLMM\"]]  <- raster::predict(object=rastercovs$summer,model=GLMMs[[\"summer\"]],const=add2,type=\"prob\",factors=levels(rastercovs$summer$veg_class))  # factor_list progress='text',factors=factor_list,\n\n\n\npredmaps[[\"summer\"]][[\"RF\"]]  <- raster::predict(object=rastercovs$summer,model=RFs[[\"summer\"]])  # factors=factor_list\n\n\n#### can't seem to use predict function- need to use another strategy...\n\nnewdata <- data.frame(\n  cos_aspect = getValues(rastercovs$summer$cos_aspect),\n  sin_aspect = getValues(rastercovs$summer$sin_aspect),\n  elevation = as.integer(getValues(rastercovs$summer$elevation)),\n  slope = as.integer(getValues(rastercovs$summer$elevation)),\n  dist_to_water = getValues(rastercovs$summer$dist_to_water),\n  veg_class = factor(veg_class$veg_class$classes[match(getValues(rastercovs$summer$veg_class),veg_class$veg_class$ID)],levels=levels(deer$summer$veg_class)),\n  stand_cos_aspect = getValues(rastercovs$summer$stand_cos_aspect),\n  stand_sin_aspect = getValues(rastercovs$summer$stand_sin_aspect),\n  stand_elevation = getValues(rastercovs$summer$stand_elevation),\n  stand_slope = getValues(rastercovs$summer$stand_slope),\n  stand_dist_to_water = getValues(rastercovs$summer$stand_dist_to_water)\n)\n\nnewdata$altid = factor( 'P003',levels=levels(deer[[\"summer\"]]$altid))\n\nhead(newdata)\n\nnewdata$veg_class[1:10]\n\n\n## deal with NAs?\n\npred1 <- plogis(predict(GLMMs[[\"summer\"]],newdata))     # predict to the full raster for summer range.  Does not take long!\npredmaps[[\"summer\"]][[\"GLMM\"]] <- rastercovs$summer$elevation\npredmaps[[\"summer\"]][[\"GLMM\"]] <- setValues(predmaps[[\"summer\"]][[\"GLMM\"]],pred1) \n\npred2 <- matrix(unlist(predict(RFs[[\"summer\"]],newdata,OOB=TRUE,type=\"prob\")),ncol=2,byrow=T)[,2]\npredmaps[[\"summer\"]][[\"RF\"]] <- rastercovs$summer$elevation\nsetValues(predmaps[[\"summer\"]][[\"RF\"]],pred2)\n\n### do class check..\n\nsapply(deer$summer,class)\nsapply(newdata,class)\n\n\n\n## visualize predictions..\n\n\nplot(predmaps[[\"summer\"]][[\"GLMM\"]])\n\n\n\n\n\n\n\n\n",
    "created" : 1506986810511.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1825933702",
    "id" : "1DC0E9EA",
    "lastKnownWriteTime" : 1510549279,
    "last_content_update" : 1510549279303,
    "path" : "E:/GIT/Mule_Deer_RFvsRSF/METHODS_PAPER_MASTER_CODE.R",
    "project_path" : "METHODS_PAPER_MASTER_CODE.R",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}